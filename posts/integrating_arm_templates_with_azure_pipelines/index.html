<!doctype html>
<html lang="en-us">
  <head>
    <title>Integrating ARM Templates with Azure Pipelines // mangoldai :: cloud architect insights</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.92.2" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.d18c46a9c052e3fff4ff60ea22fff43c74140b8b952b4bbebd229127fbf997f3.css" />
    

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Integrating ARM Templates with Azure Pipelines"/>
<meta name="twitter:description" content="Integrating ARM Templates with Azure Pipelines You can integrate Azure Resource Manager templates (ARM templates) with Azure Pipelines for continuous integration and continuous deployment (CI/CD). In this article, you will learn two more advanced ways to deploy templates with Azure Pipelines.
Select Your Option Before proceeding, let&rsquo;s consider the different options for deploying an ARM template from a pipeline:
  Use ARM Template Deployment Task: This is the easiest option when you want to deploy a template directly from a repository."/>

    <meta property="og:title" content="Integrating ARM Templates with Azure Pipelines" />
<meta property="og:description" content="Integrating ARM Templates with Azure Pipelines You can integrate Azure Resource Manager templates (ARM templates) with Azure Pipelines for continuous integration and continuous deployment (CI/CD). In this article, you will learn two more advanced ways to deploy templates with Azure Pipelines.
Select Your Option Before proceeding, let&rsquo;s consider the different options for deploying an ARM template from a pipeline:
  Use ARM Template Deployment Task: This is the easiest option when you want to deploy a template directly from a repository." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/posts/integrating_arm_templates_with_azure_pipelines/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-06-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-06-13T00:00:00+00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="http://example.org/"><img class="app-header-avatar" src="/avatar.jpg" alt="John Doe" /></a>
      <span class="app-header-title">mangoldai :: cloud architect insights</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
      </nav>
      <p>Cloud architecture, Azure, and tech innovations. Notes, tips, and insights.</p>
      <div class="app-header-social">
        
          <a href="https://github.com/jmangold23" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>My Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://www.linkedin.com/in/joshua-mangold-a7ba0989/" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>My LinkedIn</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Integrating ARM Templates with Azure Pipelines</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jun 13, 2024
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          3 min read
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="http://example.org/tags/arm/">ARM</a>
              <a class="tag" href="http://example.org/tags/ci/cd/">CI/CD</a>
              <a class="tag" href="http://example.org/tags/powershell/">PowerShell</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="integrating-arm-templates-with-azure-pipelines">Integrating ARM Templates with Azure Pipelines</h1>
<p>You can integrate Azure Resource Manager templates (ARM templates) with Azure Pipelines for continuous integration and continuous deployment (CI/CD). In this article, you will learn two more advanced ways to deploy templates with Azure Pipelines.</p>
<h2 id="select-your-option">Select Your Option</h2>
<p>Before proceeding, let&rsquo;s consider the different options for deploying an ARM template from a pipeline:</p>
<ol>
<li>
<p><strong>Use ARM Template Deployment Task</strong>: This is the easiest option when you want to deploy a template directly from a repository. This approach is covered in the tutorial <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/deployment-tutorial-pipeline">Continuous Integration of ARM Templates with Azure Pipelines</a>.</p>
</li>
<li>
<p><strong>Add Task that Runs an Azure PowerShell Script</strong>: This option provides consistency throughout the development life cycle by using the same script you used for local testing. Your script deploys the template and can also perform other operations like getting parameter values. This option is covered in the <a href="#azure-powershell-task">Azure PowerShell Task</a> section.</p>
</li>
<li>
<p><strong>Add Copy and Deploy Tasks</strong>: This offers a convenient alternative to the project script. You configure two tasks in the pipeline - one to stage the artifacts to an accessible location, and another to deploy the template from that location. This option is covered in the <a href="#copy-and-deploy-tasks">Copy and Deploy Tasks</a> section.</p>
</li>
</ol>
<h2 id="prepare-your-project">Prepare Your Project</h2>
<p>Ensure your ARM template and Azure DevOps organization are ready for creating the pipeline:</p>
<ul>
<li>You have an Azure DevOps organization. If not, <a href="https://azure.microsoft.com/en-us/services/devops/">create one for free</a>.</li>
<li>You&rsquo;ve configured a <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/library/connect-to-azure">service connection</a> to your Azure subscription.</li>
<li>You have an <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/quickstart-create-templates-use-visual-studio-code">ARM template</a> that defines the infrastructure for your project.</li>
</ul>
<h2 id="azure-powershell-task">Azure PowerShell Task</h2>
<p>This section shows how to configure continuous deployment using a single task that runs a PowerShell script in your project. You can use scripts like <a href="https://github.com/Azure/azure-quickstart-templates/blob/master/Deploy-AzTemplate.ps1">Deploy-AzTemplate.ps1</a> or <a href="https://github.com/Azure/azure-quickstart-templates/blob/master/Deploy-AzureResourceGroup.ps1">Deploy-AzureResourceGroup.ps1</a>.</p>
<p>Here&rsquo;s an example YAML file that creates an <a href="/azure/devops/pipelines/tasks/deploy/azure-powershell">Azure PowerShell task</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">trigger</span>:
- <span style="color:#ae81ff">master</span>

<span style="color:#f92672">pool</span>:
  <span style="color:#f92672">vmImage</span>: <span style="color:#e6db74">&#39;ubuntu-latest&#39;</span>

<span style="color:#f92672">steps</span>:
- <span style="color:#f92672">task</span>: <span style="color:#ae81ff">AzurePowerShell@5</span>
  <span style="color:#f92672">inputs</span>:
    <span style="color:#f92672">azureSubscription</span>: <span style="color:#e6db74">&#39;script-connection&#39;</span>
    <span style="color:#f92672">ScriptType</span>: <span style="color:#e6db74">&#39;FilePath&#39;</span>
    <span style="color:#f92672">ScriptPath</span>: <span style="color:#e6db74">&#39;./Deploy-AzTemplate.ps1&#39;</span>
    <span style="color:#f92672">ScriptArguments</span>: -<span style="color:#ae81ff">Location &#39;centralus&#39; -ResourceGroupName &#39;demogroup&#39; -TemplateFile templatesmainTemplate.json</span>
    <span style="color:#f92672">azurePowerShellVersion</span>: <span style="color:#e6db74">&#39;LatestVersion&#39;</span>
</code></pre></div><p>You&rsquo;ll need to customize the following parts for your environment:</p>
<ul>
<li><code>azureSubscription</code>: Provide the name of the service connection you created.</li>
<li><code>ScriptPath</code>: Provide the relative path from the pipeline file to your script.</li>
<li><code>ScriptArguments</code>: Provide any parameters needed by your script.</li>
</ul>
<h2 id="copy-and-deploy-tasks">Copy and Deploy Tasks</h2>
<p>This approach uses two tasks - one to stage the artifacts to a storage account, and another to deploy the template from that location.</p>
<p>The following YAML shows the <a href="/azure/devops/pipelines/tasks/deploy/azure-file-copy">Azure File Copy task</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">trigger</span>:
- <span style="color:#ae81ff">master</span>

<span style="color:#f92672">pool</span>:
  <span style="color:#f92672">vmImage</span>: <span style="color:#e6db74">&#39;windows-latest&#39;</span>

<span style="color:#f92672">steps</span>:
- <span style="color:#f92672">task</span>: <span style="color:#ae81ff">AzureFileCopy@4</span>
  <span style="color:#f92672">inputs</span>:
    <span style="color:#f92672">SourcePath</span>: <span style="color:#e6db74">&#39;templates&#39;</span>
    <span style="color:#f92672">azureSubscription</span>: <span style="color:#e6db74">&#39;copy-connection&#39;</span>
    <span style="color:#f92672">Destination</span>: <span style="color:#e6db74">&#39;AzureBlob&#39;</span>
    <span style="color:#f92672">storage</span>: <span style="color:#e6db74">&#39;demostorage&#39;</span>
    <span style="color:#f92672">ContainerName</span>: <span style="color:#e6db74">&#39;projecttemplates&#39;</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">AzureFileCopy</span>
</code></pre></div><p>You&rsquo;ll need to customize the following parts for your environment:</p>
<ul>
<li><code>SourcePath</code>: Indicate the location of the artifacts relative to the pipeline file.</li>
<li><code>azureSubscription</code>: Provide the name of the service connection you created.</li>
<li><code>storage</code> and <code>ContainerName</code>: Provide the names of the storage account and container to use for storing the artifacts.</li>
</ul>
<p>After creating the copy file task, you can add the task to deploy the staged template:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#f92672">task</span>: <span style="color:#ae81ff">AzureResourceManagerTemplateDeployment@3</span>
  <span style="color:#f92672">inputs</span>:
    <span style="color:#f92672">deploymentScope</span>: <span style="color:#e6db74">&#39;Resource Group&#39;</span>
    <span style="color:#f92672">azureResourceManagerConnection</span>: <span style="color:#e6db74">&#39;copy-connection&#39;</span>
    <span style="color:#f92672">subscriptionId</span>: <span style="color:#e6db74">&#39;00000000-0000-0000-0000-000000000000&#39;</span>
    <span style="color:#f92672">action</span>: <span style="color:#e6db74">&#39;Create Or Update Resource Group&#39;</span>
    <span style="color:#f92672">resourceGroupName</span>: <span style="color:#e6db74">&#39;demogroup&#39;</span>
    <span style="color:#f92672">location</span>: <span style="color:#e6db74">&#39;West US&#39;</span>
    <span style="color:#f92672">templateLocation</span>: <span style="color:#e6db74">&#39;URL of the file&#39;</span>
    <span style="color:#f92672">csmFileLink</span>: <span style="color:#e6db74">&#39;$(AzureFileCopy.StorageContainerUri)templates/mainTemplate.json$(AzureFileCopy.StorageContainerSasToken)&#39;</span>
    <span style="color:#f92672">csmParametersFileLink</span>: <span style="color:#e6db74">&#39;$(AzureFileCopy.StorageContainerUri)templates/mainTemplate.parameters.json$(AzureFileCopy.StorageContainerSasToken)&#39;</span>
    <span style="color:#f92672">deploymentMode</span>: <span style="color:#e6db74">&#39;Incremental&#39;</span>
    <span style="color:#f92672">deploymentName</span>: <span style="color:#e6db74">&#39;deploy1&#39;</span>
</code></pre></div><p>You&rsquo;ll need to customize the following parts for your environment:</p>
<ul>
<li><code>deploymentScope</code>: Select the scope of deployment (Resource Group, Subscription, or Management Group).</li>
<li><code>azureResourceManagerConnection</code>: Provide the name of the service connection you created.</li>
<li><code>resourceGroupName</code> and <code>location</code>: Provide the name and location of the resource group to deploy to.</li>
<li><code>csmFileLink</code>: Provide the link for the staged template using variables from the file copy task.</li>
</ul>
<p>By following these approaches, you can effectively integrate ARM templates with your Azure Pipelines for CI/CD.</p>
<p>For more information, see:</p>
<ul>
<li><a href="https://4bes.nl/2021/03/06/test-arm-templates-with-what-if/">Test ARM templates with What-If in a pipeline</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/deploy-github-actions">Deploy Azure Resource Manager templates using GitHub Actions</a></li>
</ul>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
