<!doctype html>
<html lang="en-us">
  <head>
    <title>Deploy to App Service using GitHub Actions // mangoldai :: cloud architect insights :: Joshua Mangold</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.92.2" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/mangoldaiwiki/css/main.min.d18c46a9c052e3fff4ff60ea22fff43c74140b8b952b4bbebd229127fbf997f3.css" />
    

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Deploy to App Service using GitHub Actions"/>
<meta name="twitter:description" content="Get started with GitHub Actions to automate your workflow and deploy to Azure App Service from GitHub.
Prerequisites  An Azure account with an active subscription. Create an account for free. A GitHub account. If you don&rsquo;t have one, sign up for free.  Set up GitHub Actions deployment when creating the app GitHub Actions deployment is integrated into the default app creation wizard. You just need to set Continuous deployment to Enable in the Deployment tab, and configure the organization, repository, and branch you want."/>

    <meta property="og:title" content="Deploy to App Service using GitHub Actions" />
<meta property="og:description" content="Get started with GitHub Actions to automate your workflow and deploy to Azure App Service from GitHub.
Prerequisites  An Azure account with an active subscription. Create an account for free. A GitHub account. If you don&rsquo;t have one, sign up for free.  Set up GitHub Actions deployment when creating the app GitHub Actions deployment is integrated into the default app creation wizard. You just need to set Continuous deployment to Enable in the Deployment tab, and configure the organization, repository, and branch you want." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jmangold23.github.io/mangoldaiwiki/posts/deploy_to_app_service_using_github_actions/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-03-09T00:00:00+00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://jmangold23.github.io/mangoldaiwiki/"><img class="app-header-avatar" src="/mangoldaiwiki/avatar.jpg" alt="John Doe" /></a>
      <span class="app-header-title">mangoldai :: cloud architect insights :: Joshua Mangold</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/mangoldaiwiki/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/mangoldaiwiki/tags/">Tags</a>
      </nav>
      <p>Cloud architecture, Azure, and tech innovations. Notes, tips, and insights.</p>
      <div class="app-header-social">
        
          <a href="https://github.com/jmangold23" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>My Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://www.linkedin.com/in/joshua-mangold-a7ba0989/" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>My LinkedIn</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Deploy to App Service using GitHub Actions</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Mar 9, 2024
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          4 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>Get started with <a href="https://docs.github.com/en/actions/learn-github-actions">GitHub Actions</a> to automate your workflow and deploy to <a href="https://docs.microsoft.com/en-us/azure/app-service/overview">Azure App Service</a> from GitHub.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>An Azure account with an active subscription. <a href="https://azure.microsoft.com/free/?WT.mc_id=A261C142F">Create an account for free</a>.</li>
<li>A GitHub account. If you don&rsquo;t have one, sign up for <a href="https://github.com/join">free</a>.</li>
</ul>
<h2 id="set-up-github-actions-deployment-when-creating-the-app">Set up GitHub Actions deployment when creating the app</h2>
<p>GitHub Actions deployment is integrated into the default <a href="https://portal.azure.com/#create/Microsoft.WebSite">app creation wizard</a>. You just need to set <strong>Continuous deployment</strong> to <strong>Enable</strong> in the Deployment tab, and configure the organization, repository, and branch you want.</p>
<p>![A screenshot showing how to enable GitHub Actions deployment in the App Service create wizard.][]</p>
<p>When you enable continuous deployment, the app creation wizard automatically picks the authentication method based on the basic authentication selection and configures your app and your GitHub repository accordingly:</p>
<table>
<thead>
<tr>
<th>Basic authentication selection</th>
<th>Authentication method</th>
</tr>
</thead>
<tbody>
<tr>
<td>Disable</td>
<td><a href="https://docs.microsoft.com/en-us/azure/app-service/deploy-continuous-deployment#what-does-the-user-assigned-identity-option-do-for-github-actions">User-assigned identity (OpenID Connect)</a> (recommended)</td>
</tr>
<tr>
<td>Enable</td>
<td><a href="https://docs.microsoft.com/en-us/azure/app-service/configure-basic-auth-disable">Basic authentication</a></td>
</tr>
</tbody>
</table>
<blockquote>
<p>[!NOTE]
If you receive an error when creating your app saying that your Azure account doesn&rsquo;t have certain permissions, it may not have <a href="https://docs.microsoft.com/en-us/azure/app-service/deploy-continuous-deployment#why-do-i-see-the-error-you-do-not-have-sufficient-permissions-on-this-app-to-assign-role-based-access-to-a-managed-identity-and-configure-federated-credentials">the required permissions to create and configure the user-assigned identity</a>. For an alternative, see <a href="#set-up-github-actions-deployment-from-the-deployment-center">Set up GitHub Actions deployment from the Deployment Center</a>.</p>
</blockquote>
<h2 id="set-up-github-actions-deployment-from-the-deployment-center">Set up GitHub Actions deployment from the Deployment Center</h2>
<p>For an existing app, you can get started quickly with GitHub Actions by using the App Service Deployment Center. This turn-key method automatically generates a GitHub Actions workflow file based on your application stack and commits it to your GitHub repository.</p>
<p>The Deployment Center also lets you easily configure the more secure OpenID Connect authentication with <a href="https://docs.microsoft.com/en-us/azure/app-service/deploy-continuous-deployment#what-does-the-user-assigned-identity-option-do-for-github-actions">the <strong>user-assigned identity</strong> option</a>.</p>
<p>If your Azure account has the <a href="https://docs.microsoft.com/en-us/azure/app-service/deploy-continuous-deployment#why-do-i-see-the-error-you-do-not-have-sufficient-permissions-on-this-app-to-assign-role-based-access-to-a-managed-identity-and-configure-federated-credentials">needed permissions</a>, you can select to create a user-assigned identity. Otherwise, you can select an existing user-assigned managed identity in the <strong>Identity</strong> dropdown. You can work with your Azure administrator to create a user-assigned managed identity with the <a href="https://docs.microsoft.com/en-us/azure/app-service/deploy-continuous-deployment#why-do-i-see-the-error-this-identity-does-not-have-write-permissions-on-this-app-please-select-a-different-identity-or-work-with-your-admin-to-grant-the-website-contributor-role-to-your-identity-on-this-app">Website Contributor role</a>.</p>
<p>For more information, see <a href="https://docs.microsoft.com/en-us/azure/app-service/deploy-continuous-deployment?tabs=github">Continuous deployment to Azure App Service</a>.</p>
<h2 id="set-up-a-github-actions-workflow-manually">Set up a GitHub Actions workflow manually</h2>
<p>You can also deploy a workflow without using the Deployment Center. In that case you need to perform 3 steps:</p>
<ol>
<li><a href="#1-generate-deployment-credentials">Generate deployment credentials</a></li>
<li><a href="#2-configure-the-github-secret">Configure the GitHub secret</a></li>
<li><a href="#3-add-the-workflow-file-to-your-github-repository">Add the workflow file to your GitHub repository</a></li>
</ol>
<h3 id="1-generate-deployment-credentials">1. Generate deployment credentials</h3>
<p>The recommended way to authenticate with Azure App Services for GitHub Actions is with OpenID Connect. This is an authentication method that uses short-lived tokens. Setting up <a href="/azure/developer/github/connect-from-azure">OpenID Connect with GitHub Actions</a> is more complex but offers hardened security.</p>
<p>Alternatively, you can authenticate with a User-assigned Managed Identity, a service principal, or a publish profile.</p>
<h1 id="openid-connecttabopenid"><a href="#tab/openid">OpenID Connect</a></h1>
<p>The below runs you through the steps for creating an active directory application, service principal, and federated credentials using Azure CLI statements. To learn how to create an active directory application, service principal, and federated credentials in Azure portal, see <a href="/azure/developer/github/connect-from-azure#use-the-azure-login-action-with-openid-connect">Connect GitHub and Azure</a>.</p>
<ol>
<li>
<p>If you don&rsquo;t have an existing application, register a <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal">new Active Directory application and service principal that can access resources</a>. Create the Active Directory application.</p>
<pre tabindex="0"><code class="language-azurecli-interactive" data-lang="azurecli-interactive">az ad app create --display-name myApp
</code></pre><p>This command outputs a JSON with an <code>appId</code> that is your <code>client-id</code>. Save the value to use as the <code>AZURE_CLIENT_ID</code> GitHub secret later.</p>
<p>You&rsquo;ll use the <code>objectId</code> value when creating federated credentials with Graph API and reference it as the <code>APPLICATION-OBJECT-ID</code>.</p>
</li>
<li>
<p>Create a service principal. Replace the <code>$appID</code> with the appId from your JSON output.</p>
<p>This command generates JSON output with a different <code>objectId</code> and will be used in the next step. The new  <code>objectId</code> is the <code>assignee-object-id</code>.</p>
<p>Copy the <code>appOwnerTenantId</code> to use as a GitHub secret for <code>AZURE_TENANT_ID</code> later.</p>
<pre tabindex="0"><code class="language-azurecli-interactive" data-lang="azurecli-interactive"> az ad sp create --id $appId
</code></pre></li>
<li>
<p>Create a new role assignment by subscription and object. By default, the role assignment is tied to your default subscription. Replace <code>$subscriptionId</code> with your subscription ID, <code>$resourceGroupName</code> with your resource group name, <code>$webappName</code> with your web app name, and <code>$assigneeObjectId</code> with the generated <code>id</code>. Learn <a href="/cli/azure/manage-azure-subscriptions-azure-cli">how to manage Azure subscriptions with the Azure CLI</a>.</p>
<pre tabindex="0"><code class="language-azurecli-interactive" data-lang="azurecli-interactive">az role assignment create --role contributor --subscription $subscriptionId --assignee-object-id  $assigneeObjectId --scope /subscriptions/$subscriptionId/resourceGroups/$resourceGroupName/providers/Microsoft.Web/sites/$webappName --assignee-principal-type ServicePrincipal
</code></pre></li>
<li>
<p>Run the following command to <a href="/graph/api/application-post-federatedidentitycredentials?view=graph-rest-beta&amp;preserve-view=true">create a new federated identity credential</a> for your active directory application.</p>
<ul>
<li>Replace <code>APPLICATION-OBJECT-ID</code> with the <strong>appId (generated while creating app)</strong> for your Active Directory application.</li>
<li>Set a value for <code>CREDENTIAL-NAME</code> to reference later.</li>
<li>Set the <code>subject</code>. Its value is defined by GitHub depending on your workflow:
<ul>
<li>Jobs in your GitHub Actions environment: <code>repo:&lt; Organization/Repository &gt;:environment:&lt; Name &gt;</code></li>
<li>For Jobs not tied to an environment, include the ref path for branch/tag based on the ref path used for triggering the workflow: <code>repo:&lt; Organization/Repository &gt;:ref:&lt; ref path&gt;</code>.  For example, <code>repo:n-username/ node_express:ref:refs/heads/my-branch</code> or <code>repo:n-username/ node_express:ref:refs/tags/my-tag</code>.</li>
<li>For workflows triggered by a pull request event: <code>repo:&lt; Organization/Repository &gt;:pull_request</code>.</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code class="language-azurecli" data-lang="azurecli">az ad app federated-credential create --id &lt;APPLICATION-OBJECT-ID&gt; --parameters credential.json
(&quot;credential.json</code></pre></li>
</ol>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
