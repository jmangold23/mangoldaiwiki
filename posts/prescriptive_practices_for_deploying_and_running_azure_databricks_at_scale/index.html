<!doctype html>
<html lang="en-us">
  <head>
    <title>Prescriptive Practices for Deploying and Running Azure Databricks at Scale // mangoldai :: cloud architect insights :: Joshua Mangold</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.92.2" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/mangoldaiwiki/css/main.min.d18c46a9c052e3fff4ff60ea22fff43c74140b8b952b4bbebd229127fbf997f3.css" />
    

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Prescriptive Practices for Deploying and Running Azure Databricks at Scale"/>
<meta name="twitter:description" content="Planning, deploying, and running Azure Databricks (ADB) at scale requires one to make many architectural decisions. While each ADB deployment is unique to an organization&rsquo;s needs, we have found that some patterns are common across most successful ADB projects. This guide summarizes these patterns into prescriptive and actionable best practices for Azure Databricks.
We follow a logical path of planning the infrastructure, provisioning the workspaces, developing Azure Databricks applications, and finally, running Azure Databricks in production."/>

    <meta property="og:title" content="Prescriptive Practices for Deploying and Running Azure Databricks at Scale" />
<meta property="og:description" content="Planning, deploying, and running Azure Databricks (ADB) at scale requires one to make many architectural decisions. While each ADB deployment is unique to an organization&rsquo;s needs, we have found that some patterns are common across most successful ADB projects. This guide summarizes these patterns into prescriptive and actionable best practices for Azure Databricks.
We follow a logical path of planning the infrastructure, provisioning the workspaces, developing Azure Databricks applications, and finally, running Azure Databricks in production." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jmangold23.github.io/mangoldaiwiki/posts/prescriptive_practices_for_deploying_and_running_azure_databricks_at_scale/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-05-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-05-03T00:00:00+00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://jmangold23.github.io/mangoldaiwiki/"><img class="app-header-avatar" src="/mangoldaiwiki/avatar.jpg" alt="John Doe" /></a>
      <span class="app-header-title">mangoldai :: cloud architect insights :: Joshua Mangold</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/mangoldaiwiki/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/mangoldaiwiki/tags/">Tags</a>
      </nav>
      <p>Cloud architecture, Azure, and tech innovations. Notes, tips, and insights.</p>
      <div class="app-header-social">
        
          <a href="https://github.com/jmangold23" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>My Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://www.linkedin.com/in/joshua-mangold-a7ba0989/" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>My LinkedIn</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Prescriptive Practices for Deploying and Running Azure Databricks at Scale</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          May 3, 2024
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          3 min read
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://jmangold23.github.io/mangoldaiwiki/tags/azure/">Azure</a>
              <a class="tag" href="https://jmangold23.github.io/mangoldaiwiki/tags/databricks/">databricks</a>
              <a class="tag" href="https://jmangold23.github.io/mangoldaiwiki/tags/infrastructure/">infrastructure</a>
              <a class="tag" href="https://jmangold23.github.io/mangoldaiwiki/tags/networking/">networking</a>
              <a class="tag" href="https://jmangold23.github.io/mangoldaiwiki/tags/security/">Security</a>
              <a class="tag" href="https://jmangold23.github.io/mangoldaiwiki/tags/monitoring/">Monitoring</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>Planning, deploying, and running Azure Databricks (ADB) at scale requires one to make many architectural decisions. While each ADB deployment is unique to an organization&rsquo;s needs, we have found that some patterns are common across most successful ADB projects. This guide summarizes these patterns into prescriptive and actionable best practices for Azure Databricks.</p>
<p>We follow a logical path of planning the infrastructure, provisioning the workspaces, developing Azure Databricks applications, and finally, running Azure Databricks in production. The audience of this guide are system architects, field engineers, and development teams of customers, Microsoft, and Databricks.</p>
<h2 id="scalable-adb-deployments-guidelines-for-networking-security-and-capacity-planning">Scalable ADB Deployments: Guidelines for Networking, Security, and Capacity Planning</h2>
<p>Azure Databricks is a Cloud Optimized managed PaaS offering designed to hide the underlying distributed systems and networking complexity as much as possible from the end user. It is backed by a team of support staff who monitor its health, debug tickets filed via Azure, etc. This allows ADB users to focus on developing value generating apps rather than stressing over infrastructure management.</p>
<p>We recommend:</p>
<ul>
<li>Map workspaces to business divisions to streamline access control and align with chargeback models</li>
<li>Deploy workspaces in multiple subscriptions to honor Azure and ADB workspace limits</li>
<li>Consider isolating each workspace in its own VNet and use the hub-and-spoke model</li>
<li>Select the largest VNet CIDR when using the Bring Your Own VNet feature</li>
<li>Deploy ADB with limited private IP addresses by using a disconnected VNet for the Databricks workspace</li>
</ul>
<h2 id="deploying-applications-on-adb-guidelines-for-selecting-sizing-and-optimizing-clusters-performance">Deploying Applications on ADB: Guidelines for Selecting, Sizing, and Optimizing Clusters Performance</h2>
<p>ADB clusters are divided into &ldquo;types&rdquo; (Interactive and Jobs) and &ldquo;modes&rdquo; (Standard and High Concurrency). We recommend:</p>
<ul>
<li>Use shared High Concurrency clusters for interactive analytics to minimize cost and optimize for latency</li>
<li>Use single user ephemeral Standard clusters for batch ETL workloads to improve security and throughput</li>
<li>Favor cluster-scoped init scripts over global and named scripts to avoid launch failures</li>
<li>Use the Cluster Log Delivery feature to manage logs in a blob store under your control</li>
<li>Choose VMs that match the workload class (ML, Streaming, ETL, Interactive)</li>
<li>Arrive at the correct cluster size through iterative performance testing</li>
<li>Tune shuffle parameters for optimal performance</li>
<li>Partition your data to take advantage of partition pruning and data skipping</li>
</ul>
<h2 id="running-adb-applications-smoothly-guidelines-on-observability-and-monitoring">Running ADB Applications Smoothly: Guidelines on Observability and Monitoring</h2>
<p>We focus on collecting resource utilization metrics across ADB clusters in a Log Analytics workspace, as this is the most common ask from customers. This includes:</p>
<ul>
<li>Configuring the Log Analytics Agent on each cluster node to stream VM metrics</li>
<li>Querying the collected VM metrics in Log Analytics to understand utilization</li>
</ul>
<h2 id="cost-management-chargeback-and-analysis">Cost Management, Chargeback and Analysis</h2>
<p>This section covers Azure Databricks billing, tools to manage and analyze cost, and how to charge back to teams. Key recommendations include:</p>
<ul>
<li>Leverage Azure tags (default and custom) to chargeback by filtering resource usage</li>
<li>Use the Azure Cost Management service and Power BI to create custom cost reports and visualizations</li>
<li>Be aware of pricing differences across regions and the options for pre-purchasing DBUs</li>
</ul>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
