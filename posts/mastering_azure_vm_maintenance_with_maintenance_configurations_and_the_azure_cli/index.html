<!doctype html>
<html lang="en-us">
  <head>
    <title>Mastering Azure VM Maintenance with Maintenance Configurations and the Azure CLI // Cloud architect insights :: Joshua Mangold</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.92.2" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/mangoldaiwiki/css/main.min.d18c46a9c052e3fff4ff60ea22fff43c74140b8b952b4bbebd229127fbf997f3.css" />
    

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Mastering Azure VM Maintenance with Maintenance Configurations and the Azure CLI"/>
<meta name="twitter:description" content="Maintaining a fleet of Azure virtual machines (VMs) can be a complex task, but with the Maintenance Configurations feature and the Azure CLI, you can take control of when platform updates are applied to your resources. In this comprehensive guide, we&rsquo;ll explore the ins and outs of using Maintenance Configurations to optimize your VM maintenance strategy.
Creating Maintenance Configurations The first step in managing your VM maintenance is to create a maintenance configuration."/>

    <meta property="og:title" content="Mastering Azure VM Maintenance with Maintenance Configurations and the Azure CLI" />
<meta property="og:description" content="Maintaining a fleet of Azure virtual machines (VMs) can be a complex task, but with the Maintenance Configurations feature and the Azure CLI, you can take control of when platform updates are applied to your resources. In this comprehensive guide, we&rsquo;ll explore the ins and outs of using Maintenance Configurations to optimize your VM maintenance strategy.
Creating Maintenance Configurations The first step in managing your VM maintenance is to create a maintenance configuration." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jmangold23.github.io/mangoldaiwiki/posts/mastering_azure_vm_maintenance_with_maintenance_configurations_and_the_azure_cli/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-06-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-06-20T00:00:00+00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://jmangold23.github.io/mangoldaiwiki/"><img class="app-header-avatar" src="/mangoldaiwiki/avatar.jpg" alt="John Doe" /></a>
      <span class="app-header-title">Cloud architect insights :: Joshua Mangold</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/mangoldaiwiki/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/mangoldaiwiki/tags/">Tags</a>
      </nav>
      <p>Cloud architecture, Azure, and tech innovations. Notes, tips, and insights.</p>
      <div class="app-header-social">
        
          <a href="https://github.com/jmangold23" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>My Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://www.linkedin.com/in/joshua-mangold-a7ba0989/" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>My LinkedIn</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Mastering Azure VM Maintenance with Maintenance Configurations and the Azure CLI</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jun 20, 2024
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          3 min read
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://jmangold23.github.io/mangoldaiwiki/tags/azure/">Azure</a>
              <a class="tag" href="https://jmangold23.github.io/mangoldaiwiki/tags/maintenance/">maintenance</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>Maintaining a fleet of Azure virtual machines (VMs) can be a complex task, but with the Maintenance Configurations feature and the Azure CLI, you can take control of when platform updates are applied to your resources. In this comprehensive guide, we&rsquo;ll explore the ins and outs of using Maintenance Configurations to optimize your VM maintenance strategy.</p>
<h2 id="creating-maintenance-configurations">Creating Maintenance Configurations</h2>
<p>The first step in managing your VM maintenance is to create a maintenance configuration. This involves setting up a resource group to contain your configuration, and then using the <code>az maintenance configuration create</code> command to define the specifics of your maintenance window.</p>
<p>For example, to create a maintenance configuration named <code>myConfig</code> that is scoped to host machines, with a scheduled window of 5 hours on the fourth Monday of every month, you would run the following commands:</p>
<pre tabindex="0"><code class="language-azurecli-interactive" data-lang="azurecli-interactive">az group create 
   --location eastus 
   --name myMaintenanceRG

az maintenance configuration create 
   --resource-group myMaintenanceRG 
   --resource-name myConfig 
   --maintenance-scope host 
   --location eastus 
   --maintenance-window-duration &quot;05:00&quot; 
   --maintenance-window-recur-every &quot;Month Fourth Monday&quot; 
   --maintenance-window-start-date-time &quot;2020-12-30 08:00&quot; 
   --maintenance-window-time-zone &quot;Pacific Standard Time&quot;
</code></pre><p>You can also create maintenance configurations for virtual machine scale sets and guest VMs, with different scopes and schedules to fit your needs.</p>
<h2 id="assigning-maintenance-configurations">Assigning Maintenance Configurations</h2>
<p>After creating a maintenance configuration, you need to assign it to your Azure resources. You can do this using the <code>az maintenance assignment create</code> command, specifying the resource type, resource name, resource group, and the ID of the maintenance configuration you want to apply.</p>
<p>For example, to apply the <code>myConfig</code> maintenance configuration to an isolated VM named <code>myVM</code>, you would run:</p>
<pre tabindex="0"><code class="language-azurecli-interactive" data-lang="azurecli-interactive">az maintenance assignment create 
   --resource-group myMaintenanceRG 
   --location eastus 
   --resource-name myVM 
   --resource-type virtualMachines 
   --provider-name Microsoft.Compute 
   --configuration-assignment-name myConfig 
   --maintenance-configuration-id &quot;/subscriptions/{subscription ID}/resourcegroups/myMaintenanceRG/providers/Microsoft.Maintenance/maintenanceConfigurations/myConfig&quot;
</code></pre><p>You can similarly assign maintenance configurations to dedicated hosts, virtual machine scale sets, and guest VMs, using the appropriate resource types and parameters.</p>
<h2 id="monitoring-and-applying-updates">Monitoring and Applying Updates</h2>
<p>Once you have your maintenance configurations set up, you can use the Azure CLI to check for pending updates and apply them to your VMs.</p>
<p>The <code>az maintenance update list</code> command allows you to see if there are any pending updates for your resources. If updates are pending, you can then use <code>az maintenance applyupdate create</code> to initiate the update process.</p>
<p>For example, to check for pending updates on an isolated VM named <code>myVM</code>, you would run:</p>
<pre tabindex="0"><code class="language-azurecli-interactive" data-lang="azurecli-interactive">az maintenance update list 
   --subscription {subscription ID} 
   --resource-group myMaintenanceRg 
   --resource-name myVM 
   --resource-type virtualMachines 
   --provider-name Microsoft.Compute 
   --output table
</code></pre><p>And to apply any pending updates, you would use:</p>
<pre tabindex="0"><code class="language-azurecli-interactive" data-lang="azurecli-interactive">az maintenance applyupdate create 
   --subscription {subscriptionID} 
   --resource-group myMaintenanceRG 
   --resource-name myVM 
   --resource-type virtualMachines 
   --provider-name Microsoft.Compute
</code></pre><p>You can follow a similar process for dedicated hosts, virtual machine scale sets, and guest VMs.</p>
<h2 id="deleting-maintenance-configurations">Deleting Maintenance Configurations</h2>
<p>If you no longer need a particular maintenance configuration, you can delete it using the <code>az maintenance configuration delete</code> command. This will remove the maintenance control from any associated resources.</p>
<pre tabindex="0"><code class="language-azurecli-interactive" data-lang="azurecli-interactive">az maintenance configuration delete 
   --subscription 1111abcd-1a11-1a2b-1a12-123456789abc 
   -resource-group myResourceGroup 
   --resource-name myConfig
</code></pre><p>By mastering the use of Maintenance Configurations and the Azure CLI, you can take control of your Azure VM maintenance, ensuring that platform updates are applied on your schedule and according to your specific needs. This guide has provided a comprehensive overview of the process - for more information, be sure to check out the <a href="https://docs.microsoft.com/azure/virtual-machines/maintenance-configurations-cli">official Azure documentation</a>.</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
